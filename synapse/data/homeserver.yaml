# Synapse basic configuration
server_name: "ggllp.synapse.local"
pid_file: "/data/homeserver.pid"

listeners:
  - port: 8008
    type: http
    tls: false
    bind_addresses: ['0.0.0.0']
    x_forwarded: true
    resources:
      - names: [client, federation]
        compress: false

# Disable federation (internal-only)
federation_domain_whitelist: []
allow_public_rooms_without_auth: false
allow_public_rooms_over_federation: false
federation_sender_instances: []

# PostgreSQL database configuration
database:
  name: psycopg2
  allow_unsafe_locale: true
  args:
    user: synapse
    password: change_me_to_secure
    database: synapse
    host: synapse_db
    cp_min: 5
    cp_max: 10

# File storage
media_store_path: "/data/media_store"
uploads_path: "/data/uploads"
logs_config: "/data/log.config"

# Registration and auth
enable_registration: true
registration_shared_secret: "changeme_registration_secret"
bcrypt_rounds: 12
auto_join_rooms:
  - "#general:ggllp.synapse.local"
  - "#it_helpdesk:ggllp.synapse.local"
  - "#it_announcements:ggllp.synapse.local"

# Appservice / identity / metrics (disabled for internal)
app_service_config_files: []
enable_metrics: false
enable_registration_captcha: false

# Trusted key servers (for federation, not used here)
trusted_key_servers:
  - server_name: "matrix.org"


default_identity_server: http://192.168.4.44:8008
# Report stats (disabled for privacy)
report_stats: false


# Suppress the warning for matrix.org key server
suppress_key_server_warning: true

# Disable open registration warning
enable_registration_without_verification: true

# Optional: Add more secure registration options like email or captcha if needed



# Room directory configuration
enable_room_list_search: true
# room_list_publication_rules:
#   - action: allow
#     conditions:
#       - kind: user_id
#         pattern: "@admin:ggllp.synapse.local"
room_list_publication_rules:
  - action: allow
    conditions:
      - kind: user_id
        pattern: "*"



# Logging configuration
rc_login:
  per_second: 0  # requests per second
  burst_count: 0

rc_registration:
  per_second: 0
  burst_count: 0


block_non_admin_invites: true



user_directory:
    enabled: false
    search_all_users: true
    prefer_local_users: true
    show_locked_users: true







rc_joins:
  local:
    per_second: 1024
    burst_count: 2048
rc_joins_per_room:
  per_second: 1024
  burst_count: 2048
rc_message:
  per_second: 1024
  burst_count: 2048
rc_invites:
  per_room:
    per_second: 1024
    burst_count: 2048
  per_user:
    per_second: 1024
    burst_count: 2048
  per_issuer:
    per_second: 1024
    burst_count: 2048
# app_service_config_files:
#   - /data/app-service.yaml
app_service_config_files:
  - /data/rc2matrix.yaml
